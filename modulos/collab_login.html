<div>
  <h2>Acceso Colaborador (Editor)</h2>
  <div id="collab-message"></div>
  <form id="collab-login-form">
    <div>
      <label for="collab-email">Email</label>
      <input type="email" id="collab-email" required>
    </div>
    <div>
      <label for="collab-password">Contraseña</label>
      <input type="password" id="collab-password" required>
    </div>
    <div style="margin-top:8px;">
      <button type="submit">Entrar como Colaborador</button>
    </div>
  </form>

  <script type="module">
    import { authenticateSupabase } from './authSupabase.js';

    const form = document.getElementById('collab-login-form');
    const msg = document.getElementById('collab-message');

    function showMessage(text, type = 'error') {
      msg.innerHTML = `<div class="message ${type}">${text}</div>`;
    }

    form.addEventListener('submit', async (e) => {
      e.preventDefault();
      const email = document.getElementById('collab-email').value;
      const password = document.getElementById('collab-password').value;

      // Obtener credenciales de Supabase desde la ventana padre (auth.js expone getSupabaseCreds)
      let creds = null;
      try {
        if (window.opener && typeof window.opener.getSupabaseCreds === 'function') {
          creds = window.opener.getSupabaseCreds();
        }
      } catch (err) {
        console.error('No se pudo obtener credenciales de la ventana padre', err);
      }

      if (!creds || !creds.url || !creds.key) {
        showMessage('Error: credenciales de Supabase no disponibles', 'error');
        return;
      }

      showMessage('Autenticando...', 'info');
      const result = await authenticateSupabase(creds.url, creds.key, email, password);
      if (!result.success) {
        showMessage('Credenciales incorrectas. Si el error persiste, es posible que tu acceso de editor todavía se esté procesando.', 'error');
        return;
      }

      // Post message to opener to indicate success
      if (window.opener) {
        window.opener.postMessage({ type: 'collab-auth-success', email }, '*');
      }
      showMessage('Autenticación exitosa. Puedes cerrar esta ventana.', 'success');
    });
  </script>
</div>
