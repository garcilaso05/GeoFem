<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GeoFem</title>
  <link rel="icon" href="favicon.ico" type="image/x-icon">
  <link rel="stylesheet" href="https://use.typekit.net/bxb1fnf.css">
  <link rel="stylesheet" href="estilos.css?v=3">
  
  <!-- Leaflet CSS y JS para mapas -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
</head>
<body>
  <!-- ============================================ -->
  <!-- PANTALLA DE CARGA GLOBAL                    -->
  <!-- ============================================ -->
  <div id="global-loading-screen" class="hidden">
    <div class="loading-logo-container">
      <img src="logo.png" alt="GeoFem Logo" class="loading-logo-img">
      <div class="loading-logo-title">GeoFem</div>
    </div>
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loading-text">Inicializando aplicaci√≥n...</div>
    <div class="loading-subtext" id="loading-subtext">Cargando metadatos de la base de datos</div>
    <div class="loading-progress">
      <div class="loading-progress-bar" id="loading-progress-bar"></div>
    </div>
    <div class="loading-stats" id="loading-stats"></div>
  </div>

  <!-- ============================================ -->
  <!-- VISTA DE AUTENTICACI√ìN (Login/Registro)     -->
  <!-- ============================================ -->
  <div id="auth-view">
    <main id="auth-content">
      <div class="auth-logo-header">
        <img src="logo.png" alt="GeoFem Logo" class="auth-logo">
        <h1 class="auth-title">GeoFem</h1>
      </div>
      
      <div class="tabs">
        <div id="tab-login" class="tab-title">Iniciar Sesi√≥n</div>
      </div>
      
      <div id="message-container"></div>

      <!-- Formulario de Inicio de Sesi√≥n -->
      <form id="login-form">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" required>
        </div>
        <div class="form-group">
          <label for="login-password">Contrase√±a</label>
          <input type="password" id="login-password" required>
        </div>
        <button type="submit">Iniciar Sesi√≥n</button>
      </form>

      <!-- Aviso √©tico y de confidencialidad: siempre visible en la pantalla de login -->
      <div class="ethics-note" id="ethics-note">
        La informaci√≥n proporcionada ser√° tratada de forma estrictamente confidencial. Se garantizar√° el cumplimiento del secreto profesional y la seguridad de los datos seg√∫n normativa europea y el Comit√© de √âtica de la URV. Los resultados solo se difundir√°n con finalidad cient√≠fica, siempre preservando el anonimato.
      </div>

      <!-- El formulario de registro se ha movido a modulos/registro.html -->
    </main>
  </div>

  <!-- ============================================ -->
  <!-- VISTA DE USUARIO (Informaci√≥n b√°sica)       -->
  <!-- ============================================ -->
  <div id="user-view" class="hidden">
    <header id="auth-header">
      <h1>GeoFem - Control de Acceso</h1>
    </header>
    
    <main id="auth-content">
      <h2>Bienvenido</h2>
      <div class="user-info">
        <p><strong>Email:</strong> <span id="user-email"></span></p>
        <p><strong>UID:</strong> <span id="user-uid"></span></p>
        <p><strong>Rol:</strong> <span id="user-role">Cargando...</span></p>
      </div>
      <button class="secondary" id="logout-btn">Cerrar Sesi√≥n</button>
    </main>
  </div>

  <!-- ============================================ -->
  <!-- VISTA DE APLICACI√ìN (M√≥dulos)               -->
  <!-- ============================================ -->
  <div id="app-view" class="hidden">
    <div class="app-container">
      <nav id="app-nav">
        <div class="nav-logo-header">
          <img src="logo2.png" alt="GeoFem Logo" class="nav-logo">
          <h2 class="nav-title">GeoFem</h2>
        </div>
        <div class="nav-divider"></div>
        
        <!-- Selector de esquema -->
        <div class="nav-section">
          <label class="nav-label">Base de datos:</label>
          <select id="schema-selector" class="nav-select" onchange="changeSchema(this.value)">
            <option value="mdr">Madres</option>
            <option value="hrf">Hu√©rfanos</option>
          </select>
        </div>
        
        <div class="nav-divider"></div>
        
        <button onclick="loadModule('visualizar_datos')"><img src="server-storage.png" alt="" class="nav-icon">Visualizar Datos</button>
        <button onclick="loadModule('generar_graficos')"><img src="chart-down.png" alt="" class="nav-icon">Generar Gr√°ficos</button>
        <button onclick="loadModule('geomapa')"><img src="maps-and-flags.png" alt="" class="nav-icon">Geolocalizaci√≥n</button>
        <button onclick="loadModule('buscar_caso')"><img src="search.png" alt="" class="nav-icon">B√∫squeda Avanzada</button>
        <!-- Botones solo para administradores -->
        <button class="admin-only" onclick="loadModule('editar_caso')"><img src="pencil.png" alt="" class="nav-icon">Editar Caso</button>
        <button class="admin-only" onclick="loadModule('crear_enumerado')"><img src="list.png" alt="" class="nav-icon">Crear Enumerado</button>
        <button class="admin-only" onclick="loadModule('editar_tabla')"><img src="tool.png" alt="" class="nav-icon">Editar Estructura</button>
        <button class="admin-only" onclick="loadModule('inserciones')"><img src="plus-sign.png" alt="" class="nav-icon">Insertar Nuevo Caso</button>
        <button class="admin-only" onclick="loadModule('admin_crear_usuario')"><img src="user-plus.png" alt="" class="nav-icon">Crear Usuario</button>
        
        <div class="nav-divider"></div>
        
        <!-- Email del usuario -->
        <div class="nav-section nav-user-section">
          <label class="nav-label">Usuario:</label>
          <span id="app-user-email" class="nav-user-email"></span>
        </div>
        
        <!-- Bot√≥n de cerrar sesi√≥n -->
        <button class="nav-logout" id="app-logout-btn"><img src="logout.png" alt="" class="nav-icon">Cerrar Sesi√≥n</button>
      </nav>
      
      <main id="app-main">
        <div id="module-container">
          <p class="text-center text-gray">Selecciona un m√≥dulo del men√∫ lateral</p>
        </div>
      </main>
    </div>
  </div>

  <!-- Tooltip para mostrar referencias de claves for√°neas -->
  <div id="foreignKeyTooltip"></div>

  <script type="module" src="auth.js"></script>
  
  <!-- Limpiar cach√© al cerrar ventana/pesta√±a -->
  <script>
    // Limpiar sessionStorage al cerrar la ventana/pesta√±a
    window.addEventListener('beforeunload', () => {
      console.log('üßπ Limpiando cach√© al cerrar ventana...');
      sessionStorage.clear();
    });
    
    // Tambi√©n limpiar al cambiar de p√°gina (por si acaso)
    window.addEventListener('pagehide', () => {
      console.log('üßπ Limpiando cach√© al ocultar p√°gina...');
      sessionStorage.clear();
    });
  </script>
</body>
</html>
