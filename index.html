<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="UTF-8">
  <title>GeoFem - Control de Acceso</title>
  <link rel="stylesheet" href="https://use.typekit.net/bxb1fnf.css">
  <link rel="stylesheet" href="estilos.css?v=3">
  
  <!-- Leaflet CSS y JS para mapas -->
  <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.css" />
  <link rel="stylesheet" href="https://unpkg.com/leaflet.markercluster@1.5.3/dist/MarkerCluster.Default.css" />
  <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
  <script src="https://unpkg.com/leaflet.markercluster@1.5.3/dist/leaflet.markercluster.js"></script>
  <script src="https://unpkg.com/leaflet.heat@0.2.0/dist/leaflet-heat.js"></script>
</head>
<body>
  <!-- ============================================ -->
  <!-- PANTALLA DE CARGA GLOBAL                    -->
  <!-- ============================================ -->
  <div id="global-loading-screen" class="hidden">
    <div class="loading-logo-container">
      <img src="logo.png" alt="GeoFem Logo" class="loading-logo-img">
      <div class="loading-logo-title">GeoFem</div>
    </div>
    <div class="loading-spinner"></div>
    <div class="loading-text" id="loading-text">Inicializando aplicación...</div>
    <div class="loading-subtext" id="loading-subtext">Cargando metadatos de la base de datos</div>
    <div class="loading-progress">
      <div class="loading-progress-bar" id="loading-progress-bar"></div>
    </div>
    <div class="loading-stats" id="loading-stats"></div>
  </div>

  <!-- ============================================ -->
  <!-- VISTA DE AUTENTICACIÓN (Login/Registro)     -->
  <!-- ============================================ -->
  <div id="auth-view">
    <main id="auth-content">
      <div class="auth-logo-header">
        <img src="logo.png" alt="GeoFem Logo" class="auth-logo">
        <h1 class="auth-title">GeoFem</h1>
      </div>
      
      <div class="tabs">
        <button id="tab-login" class="active" onclick="showTab('login')">Iniciar Sesión</button>
        <button id="tab-register" onclick="showTab('register')">Registrarse</button>
      </div>
      
      <div id="message-container"></div>

      <!-- Formulario de Inicio de Sesión -->
      <form id="login-form">
        <div class="form-group">
          <label for="login-email">Email</label>
          <input type="email" id="login-email" required>
        </div>
        <div class="form-group">
          <label for="login-password">Contraseña</label>
          <input type="password" id="login-password" required>
        </div>
        <button type="submit">Iniciar Sesión</button>
      </form>

      <!-- Formulario de Registro -->
      <form id="register-form" class="hidden">
        <div class="form-group">
          <label for="register-email">Email</label>
          <input type="email" id="register-email" required>
        </div>
        <div class="form-group">
          <label for="register-password">Contraseña</label>
          <input type="password" id="register-password" required minlength="6">
        </div>
        <div class="form-group">
          <label for="register-password-confirm">Confirmar Contraseña</label>
          <input type="password" id="register-password-confirm" required minlength="6">
        </div>
        <button type="submit">Registrarse</button>
      </form>
    </main>
  </div>

  <!-- ============================================ -->
  <!-- VISTA DE USUARIO (Información básica)       -->
  <!-- ============================================ -->
  <div id="user-view" class="hidden">
    <header id="auth-header">
      <h1>GeoFem - Control de Acceso</h1>
    </header>
    
    <main id="auth-content">
      <h2>Bienvenido</h2>
      <div class="user-info">
        <p><strong>Email:</strong> <span id="user-email"></span></p>
        <p><strong>UID:</strong> <span id="user-uid"></span></p>
        <p><strong>Rol:</strong> <span id="user-role">Cargando...</span></p>
      </div>
      <button class="secondary" id="logout-btn">Cerrar Sesión</button>
    </main>
  </div>

  <!-- ============================================ -->
  <!-- VISTA DE APLICACIÓN (Módulos)               -->
  <!-- ============================================ -->
  <div id="app-view" class="hidden">
    <div class="app-container">
      <nav id="app-nav">
        <div class="nav-logo-header">
          <img src="logo.png" alt="GeoFem Logo" class="nav-logo">
          <h2 class="nav-title">GeoFem</h2>
        </div>
        <div class="nav-divider"></div>
        
        <!-- Selector de esquema -->
        <div class="nav-section">
          <label class="nav-label">Base de datos:</label>
          <select id="schema-selector" class="nav-select" onchange="changeSchema(this.value)">
            <option value="mdr">Madres</option>
            <option value="hrf">Huérfanos</option>
          </select>
        </div>
        
        <div class="nav-divider"></div>
        
        <button onclick="loadModule('visualizar_datos')"><img src="server-storage.png" alt="" class="nav-icon">Visualizar Datos</button>
        <button onclick="loadModule('generar_graficos')"><img src="chart-down.png" alt="" class="nav-icon">Generar Gráficos</button>
        <button onclick="loadModule('geomapa')"><img src="maps-and-flags.png" alt="" class="nav-icon">Geolocalización</button>
        <button onclick="loadModule('buscar_caso')"><img src="search.png" alt="" class="nav-icon">Buscar Caso</button>
        <!-- Botones solo para administradores -->
        <button class="admin-only" onclick="loadModule('editar_caso')"><img src="pencil.png" alt="" class="nav-icon">Editar Caso</button>
        <button class="admin-only" onclick="loadModule('crear_enumerado')"><img src="list.png" alt="" class="nav-icon">Crear Enumerado</button>
        <button class="admin-only" onclick="loadModule('editar_tabla')"><img src="tool.png" alt="" class="nav-icon">Editar Estructura</button>
        <button class="admin-only" onclick="loadModule('inserciones')"><img src="plus-sign.png" alt="" class="nav-icon">Insertar Nuevo Caso</button>
        
        <div class="nav-divider"></div>
        
        <!-- Email del usuario -->
        <div class="nav-section nav-user-section">
          <label class="nav-label">Usuario:</label>
          <span id="app-user-email" class="nav-user-email"></span>
        </div>
        
        <!-- Botón de cerrar sesión -->
        <button class="nav-logout" id="app-logout-btn"><img src="logout.png" alt="" class="nav-icon">Cerrar Sesión</button>
      </nav>
      
      <main id="app-main">
        <div id="module-container">
          <p class="text-center text-gray">Selecciona un módulo del menú lateral</p>
        </div>
      </main>
    </div>
  </div>

  <!-- Tooltip para mostrar referencias de claves foráneas -->
  <div id="foreignKeyTooltip"></div>

  <script type="module" src="auth.js"></script>
</body>
</html>
